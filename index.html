<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="theme-color" content="#0b1020" />
  <title>TAP TYCOON ‚Äî Ultra Easy Clicker</title>
  <style>
    :root{
      --bg0:#060914; --bg1:#0b1020;
      --glass: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.14);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --good:#7CFFB2; --warn:#FFD27C; --bad:#FF5A7A;
      --shadow: rgba(0,0,0,.45);
    }
    html,body{
      margin:0; height:100%; overflow:hidden;
      background:
        radial-gradient(1100px 700px at 20% 10%, rgba(120,140,255,.22), transparent 60%),
        radial-gradient(900px 600px at 80% 25%, rgba(255,120,220,.18), transparent 55%),
        linear-gradient(180deg,var(--bg1),var(--bg0));
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      user-select:none;
    }

    /* Layout */
    #app{
      position:fixed; inset:0;
      display:flex; flex-direction:column;
      padding:
        max(14px, env(safe-area-inset-top))
        max(14px, env(safe-area-inset-right))
        max(14px, env(safe-area-inset-bottom))
        max(14px, env(safe-area-inset-left));
      gap:12px;
    }

    .topbar{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }

    .pill{
      display:flex; align-items:baseline; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      box-shadow: 0 16px 55px var(--shadow);
      backdrop-filter: blur(12px);
      font-weight:900;
      letter-spacing:.2px;
    }
    .pill small{ color:var(--muted); font-weight:800; }
    .btn{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      color:var(--txt);
      border-radius:999px;
      padding:10px 12px;
      font-weight:950;
      letter-spacing:.2px;
      box-shadow: 0 16px 55px var(--shadow);
      backdrop-filter: blur(10px);
    }
    .btn:active{ transform: scale(.98); }

    .mid{
      flex: 1 1 auto;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap:12px;
      position:relative;
      overflow:hidden;
    }

    /* Big tap button */
    #tapBtn{
      width:min(300px, 72vw);
      aspect-ratio:1/1;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.18), transparent 45%),
        linear-gradient(135deg, rgba(116,216,255,.95), rgba(255,109,246,.90));
      box-shadow:
        0 22px 90px rgba(0,0,0,.55),
        0 0 45px rgba(116,216,255,.25);
      position:relative;
      display:flex; align-items:center; justify-content:center;
      font-weight:1000;
      letter-spacing:.4px;
      cursor:pointer;
      transform: translateZ(0);
      transition: transform .08s ease, filter .10s ease;
    }
    #tapBtn:active{ transform: scale(.98); filter: brightness(1.06); }
    #tapBtn .label{
      text-align:center;
      line-height:1.05;
      text-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    #tapBtn .label .big{
      font-size: clamp(30px, 6.5vw, 44px);
    }
    #tapBtn .label .small{
      margin-top:8px;
      font-size: 14px;
      font-weight:900;
      color: rgba(255,255,255,.85);
      opacity:.95;
    }
    /* pulse ring */
    #tapBtn::after{
      content:"";
      position:absolute; inset:-18px;
      border-radius:999px;
      border: 2px solid rgba(255,255,255,.10);
      box-shadow: 0 0 40px rgba(255,109,246,.18);
      opacity:.0;
      animation: pulse 1.8s ease-in-out infinite;
    }
    @keyframes pulse{
      0%{ transform: scale(.96); opacity:.0; }
      35%{ opacity:.25; }
      70%{ transform: scale(1.06); opacity:.05; }
      100%{ transform: scale(1.08); opacity:0; }
    }

    .statsLine{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
      color:var(--muted);
      font-weight:850;
      text-align:center;
    }
    .statsLine b{ color:var(--txt); }

    /* Shop panel */
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius: 22px;
      box-shadow: 0 18px 80px rgba(0,0,0,.45);
      backdrop-filter: blur(12px);
      padding:12px;
    }
    .panelHeader{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom:10px;
    }
    .panelHeader .title{
      font-weight:1000;
      letter-spacing:.3px;
      display:flex; align-items:center; gap:10px;
    }
    .muted{ color:var(--muted); font-weight:800; }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 420px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height: 108px;
    }
    .card .name{ font-weight:1000; }
    .card .desc{ color:var(--muted); font-weight:800; font-size:12px; line-height:1.25; }
    .card .row{
      display:flex; justify-content:space-between; align-items:center; gap:8px;
      margin-top:auto;
    }
    .buy{
      padding:9px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      color:var(--txt);
      font-weight:1000;
    }
    .buy:active{ transform: scale(.98); }
    .buy[disabled]{ opacity:.45; }

    /* Toast */
    #toasts{
      position:fixed; left:50%; transform:translateX(-50%);
      top: calc(max(12px, env(safe-area-inset-top)) + 62px);
      display:flex; flex-direction:column; gap:8px;
      pointer-events:none;
      z-index:50;
    }
    .toast{
      padding:10px 12px;
      border-radius:999px;
      background: rgba(16,20,40,.72);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 18px 70px rgba(0,0,0,.45);
      backdrop-filter: blur(12px);
      font-weight:950;
      opacity:0;
      transform: translateY(-8px) scale(.98);
      animation: tin .22s ease forwards, tout .22s ease forwards;
      animation-delay: 0ms, 1500ms;
      max-width: min(92vw, 520px);
      text-align:center;
    }
    .toast small{ color:var(--muted); font-weight:850; }
    @keyframes tin{ to{opacity:1; transform: translateY(0) scale(1);} }
    @keyframes tout{ to{opacity:0; transform: translateY(-10px) scale(.98);} }

    /* Floating numbers */
    .float{
      position:absolute;
      font-weight:1000;
      pointer-events:none;
      text-shadow: 0 14px 40px rgba(0,0,0,.45);
      will-change: transform, opacity;
    }

    /* Bonus drop (big star) */
    #bonus{
      position:absolute;
      width:72px; height:72px;
      border-radius: 18px;
      display:none;
      align-items:center; justify-content:center;
      background: linear-gradient(135deg, rgba(255,210,124,.95), rgba(255,90,122,.88));
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 22px 80px rgba(0,0,0,.45), 0 0 45px rgba(255,210,124,.22);
      cursor:pointer;
    }
    #bonus:active{ transform: scale(.98); }
    #bonus span{ font-size:34px; filter: drop-shadow(0 12px 30px rgba(0,0,0,.35)); }
  </style>
</head>
<body>
  <div id="toasts"></div>

  <div id="app">
    <div class="topbar">
      <div class="pill"><span id="money">0</span> <small>Coins</small></div>
      <div style="display:flex; gap:10px;">
        <button class="btn" id="sound">üîä</button>
        <button class="btn" id="vibe">üì≥</button>
        <button class="btn" id="menu">‚ÑπÔ∏è</button>
      </div>
    </div>

    <div class="mid" id="mid">
      <div id="bonus" title="Bonus! Tippen!"><span>‚≠ê</span></div>

      <div id="tapBtn" role="button" aria-label="Tippen um Coins zu bekommen">
        <div class="label">
          <div class="big">TIPPE!</div>
          <div class="small">+<span id="perClick">1</span> pro Tap</div>
        </div>
      </div>

      <div class="statsLine">
        <span><b id="cps">0</b> / Sek</span>
        <span>‚Ä¢</span>
        <span>Best: <b id="best">0</b></span>
        <span>‚Ä¢</span>
        <span>Level: <b id="lvl">1</b></span>
      </div>
      <div class="muted" style="text-align:center; max-width:520px; line-height:1.25;">
        Kauf Upgrades ‚Üí automatisch Coins / Sek. Ab und zu spawnt ein ‚≠ê Bonus.
      </div>
    </div>

    <div class="panel">
      <div class="panelHeader">
        <div class="title">üõí Shop</div>
        <div class="muted">Tip: erst ‚ÄúAuto-Click‚Äù holen</div>
      </div>
      <div class="grid" id="shopGrid"></div>
    </div>
  </div>

<script>
(() => {
  "use strict";

  // ---------- utils ----------
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
  const fmt = (n) => {
    n = Math.floor(n);
    if (n < 1000) return ""+n;
    const units = ["K","M","B","T"];
    let u = -1;
    let x = n;
    while (x >= 1000 && u < units.length-1){ x/=1000; u++; }
    return (x>=100 ? x.toFixed(0) : x>=10 ? x.toFixed(1) : x.toFixed(2)) + units[u];
  };
  const now = () => Date.now();
  const rnd = (a,b)=>a+Math.random()*(b-a);

  // ---------- DOM ----------
  const $money = document.getElementById("money");
  const $perClick = document.getElementById("perClick");
  const $cps = document.getElementById("cps");
  const $best = document.getElementById("best");
  const $lvl = document.getElementById("lvl");

  const $tapBtn = document.getElementById("tapBtn");
  const $mid = document.getElementById("mid");
  const $shopGrid = document.getElementById("shopGrid");

  const $toasts = document.getElementById("toasts");
  const $sound = document.getElementById("sound");
  const $vibe = document.getElementById("vibe");
  const $menu = document.getElementById("menu");

  const $bonus = document.getElementById("bonus");

  // ---------- audio (simple beep) ----------
  let audioCtx = null;
  let soundOn = true;
  function beep(freq=520, dur=0.045, gain=0.06, type="triangle"){
    if (!soundOn) return;
    try{
      audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
      const t0 = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.setValueAtTime(freq, t0);
      g.gain.setValueAtTime(0.0001, t0);
      g.gain.exponentialRampToValueAtTime(gain, t0 + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(t0); o.stop(t0 + dur + 0.02);
    }catch(_){}
  }

  // ---------- vibration ----------
  let vibeOn = true;
  const vibrate = (ms)=>{ if (vibeOn && navigator.vibrate) navigator.vibrate(ms); };

  // ---------- storage ----------
  const KEY = "tap_tycoon_v1";
  const load = () => { try { return JSON.parse(localStorage.getItem(KEY)||"{}"); } catch { return {}; } };
  const save = (obj) => localStorage.setItem(KEY, JSON.stringify(obj));

  // ---------- game data ----------
  const upgrades = [
    { id:"auto",  name:"Auto-Click", desc:"+0.5 / Sek", baseCost: 25,  cpsAdd: 0.5 },
    { id:"bot",   name:"Mini-Bot",   desc:"+2 / Sek",   baseCost: 120, cpsAdd: 2 },
    { id:"drone", name:"Drone",      desc:"+8 / Sek",   baseCost: 520, cpsAdd: 8 },
    { id:"lab",   name:"Labor",      desc:"+30 / Sek",  baseCost: 2400,cpsAdd: 30 },
    { id:"tower", name:"Tower",      desc:"+120 / Sek", baseCost: 12000,cpsAdd: 120 },
    { id:"core",  name:"Core",       desc:"+500 / Sek", baseCost: 65000,cpsAdd: 500 },
  ];

  const S = {
    coins: 0,
    best: 0,
    level: 1,
    perClick: 1,
    levelsBought: {}, // upgrade levels
    lastTick: now(),
    lastSave: now(),
    lastBonusAt: 0,
    bonusActive: false,
    bonusHideT: 0
  };

  // ---------- init from storage ----------
  const d = load();
  S.coins = Number(d.coins || 0);
  S.best  = Number(d.best  || 0);
  S.level = Number(d.level || 1);
  S.perClick = Number(d.perClick || 1);
  S.levelsBought = (d.levelsBought && typeof d.levelsBought === "object") ? d.levelsBought : {};
  soundOn = d.soundOn !== false;
  vibeOn  = d.vibeOn  !== false;
  S.lastTick = Number(d.lastTick || now());

  // Offline progress (cap so it doesn't explode)
  const offlineMs = clamp(now() - S.lastTick, 0, 1000*60*60*6); // max 6h
  // compute cps and grant
  function getCps(){
    let cps = 0;
    for (const u of upgrades){
      const lvl = Number(S.levelsBought[u.id] || 0);
      cps += lvl * u.cpsAdd;
    }
    return cps;
  }
  const offlineCoins = getCps() * (offlineMs/1000);
  if (offlineCoins >= 1){
    S.coins += offlineCoins;
  }

  // ---------- helpers ----------
  function costFor(u){
    const lvl = Number(S.levelsBought[u.id] || 0);
    return Math.floor(u.baseCost * Math.pow(1.18, lvl));
  }

  function toast(msg, sub=""){
    const el = document.createElement("div");
    el.className = "toast";
    el.innerHTML = sub ? `${msg} <small>${sub}</small>` : msg;
    $toasts.appendChild(el);
    setTimeout(()=>el.remove(), 1850);
  }

  function floatText(text, x, y){
    const el = document.createElement("div");
    el.className = "float";
    el.textContent = text;
    el.style.left = x + "px";
    el.style.top  = y + "px";
    el.style.opacity = "1";
    el.style.transform = "translate(-50%, -10px) scale(1)";
    el.style.fontSize = "18px";
    $mid.appendChild(el);

    const dx = rnd(-18, 18);
    const dy = rnd(-60, -90);
    const t0 = performance.now();
    const dur = 700;

    const step = (t)=>{
      const k = clamp((t - t0)/dur, 0, 1);
      el.style.opacity = String(1 - k);
      el.style.transform = `translate(calc(-50% + ${dx*k}px), ${dy*k}px) scale(${1 - k*0.15})`;
      if (k < 1) requestAnimationFrame(step);
      else el.remove();
    };
    requestAnimationFrame(step);
  }

  function updateDerived(){
    // level based on best coins (simple & satisfying)
    S.level = Math.max(1, Math.floor(Math.sqrt(S.best/120)) + 1);
    // per click scales lightly with level
    S.perClick = 1 + Math.floor((S.level-1) * 0.35);

    // UI
    const cps = getCps();
    $money.textContent = fmt(S.coins);
    $perClick.textContent = fmt(S.perClick);
    $cps.textContent = fmt(cps);
    $best.textContent = fmt(S.best);
    $lvl.textContent = String(S.level);

    $sound.textContent = soundOn ? "üîä" : "üîá";
    $vibe.textContent  = vibeOn ? "üì≥" : "üö´";
  }

  function saveAll(){
    S.lastTick = now();
    save({
      coins: S.coins,
      best:  S.best,
      level: S.level,
      perClick: S.perClick,
      levelsBought: S.levelsBought,
      soundOn, vibeOn,
      lastTick: S.lastTick
    });
  }

  // ---------- shop ----------
  function buildShop(){
    $shopGrid.innerHTML = "";
    for (const u of upgrades){
      const lvl = Number(S.levelsBought[u.id] || 0);
      const cost = costFor(u);

      const card = document.createElement("div");
      card.className = "card";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = `${u.name}  (Lvl ${lvl})`;

      const desc = document.createElement("div");
      desc.className = "desc";
      desc.textContent = u.desc;

      const row = document.createElement("div");
      row.className = "row";

      const price = document.createElement("div");
      price.className = "muted";
      price.textContent = `Kosten: ${fmt(cost)}`;

      const buy = document.createElement("button");
      buy.className = "buy";
      buy.textContent = "Kaufen";
      buy.disabled = S.coins < cost;
      buy.addEventListener("click", () => {
        if (S.coins < cost) { toast("Zu wenig Coins"); vibrate(10); return; }
        S.coins -= cost;
        S.levelsBought[u.id] = lvl + 1;
        beep(680, 0.05, 0.06, "triangle");
        vibrate(12);
        toast("Upgrade gekauft!", `${u.name} ‚Üí Lvl ${lvl+1}`);
        updateDerived();
        buildShop();
        saveAll();
      });

      row.appendChild(price);
      row.appendChild(buy);

      card.appendChild(name);
      card.appendChild(desc);
      card.appendChild(row);

      $shopGrid.appendChild(card);
    }
  }

  // ---------- tap action ----------
  function doTap(clientX, clientY){
    // wake audio on first interaction
    if (audioCtx && audioCtx.state === "suspended") audioCtx.resume().catch(()=>{});

    const gain = S.perClick;
    S.coins += gain;
    S.best = Math.max(S.best, S.coins);

    beep(520 + Math.min(700, gain*6), 0.035, 0.05, "triangle");
    vibrate(8);

    // floating number
    const rect = $mid.getBoundingClientRect();
    const x = clamp(clientX - rect.left, 20, rect.width - 20);
    const y = clamp(clientY - rect.top, 20, rect.height - 20);
    floatText("+" + fmt(gain), x, y);

    updateDerived();
    buildShop();

    // bonus chance: tiny chance per tap
    if (!S.bonusActive && Math.random() < 0.035){
      spawnBonus();
    }
  }

  $tapBtn.addEventListener("pointerdown", (e) => {
    e.preventDefault();
    doTap(e.clientX, e.clientY);
  });

  // ---------- bonus star ----------
  function spawnBonus(){
    S.bonusActive = true;
    const rect = $mid.getBoundingClientRect();
    const x = rnd(50, rect.width - 50);
    const y = rnd(30, rect.height - 120);

    $bonus.style.display = "flex";
    $bonus.style.left = x + "px";
    $bonus.style.top  = y + "px";
    $bonus.style.transform = "translate(-50%, -50%) scale(1)";
    S.bonusHideT = now() + 5000; // disappears after 5s
    toast("‚≠ê BONUS!", "Tippe schnell!");
  }

  $bonus.addEventListener("pointerdown", (e) => {
    e.preventDefault();
    if (!S.bonusActive) return;

    const cps = getCps();
    const bonus = Math.max(10, Math.floor(15 + cps * 2.2 + S.level * 3));
    S.coins += bonus;
    S.best = Math.max(S.best, S.coins);

    beep(900, 0.07, 0.07, "sawtooth");
    vibrate(22);
    toast("BONUS geholt!", `+${fmt(bonus)} Coins`);

    // float
    const rect = $mid.getBoundingClientRect();
    floatText("+" + fmt(bonus), rect.width/2, rect.height/2 - 10);

    S.bonusActive = false;
    $bonus.style.display = "none";

    updateDerived();
    buildShop();
    saveAll();
  });

  // ---------- settings ----------
  $sound.addEventListener("click", () => {
    soundOn = !soundOn;
    toast(soundOn ? "Sound an" : "Sound aus");
    if (soundOn) beep(620, 0.04, 0.05, "triangle");
    updateDerived();
    saveAll();
  });

  $vibe.addEventListener("click", () => {
    vibeOn = !vibeOn;
    toast(vibeOn ? "Vibration an" : "Vibration aus");
    if (vibeOn) vibrate(15);
    updateDerived();
    saveAll();
  });

  $menu.addEventListener("click", () => {
    const cps = getCps();
    toast("TAP TYCOON", `Tippe ‚Üí Coins. Upgrades ‚Üí +/Sek. Aktuell: ${fmt(cps)}/Sek`);
    beep(560, 0.04, 0.05, "triangle");
  });

  // ---------- main tick ----------
  let last = performance.now();
  function loop(t){
    const dt = Math.min(0.05, (t-last)/1000);
    last = t;

    // income
    const cps = getCps();
    if (cps > 0){
      S.coins += cps * dt;
      S.best = Math.max(S.best, S.coins);
    }

    // bonus timeout
    if (S.bonusActive && now() > S.bonusHideT){
      S.bonusActive = false;
      $bonus.style.display = "none";
    }

    updateDerived();

    // save every ~4s
    if (now() - S.lastSave > 4000){
      S.lastSave = now();
      saveAll();
    }

    requestAnimationFrame(loop);
  }

  // ---------- start ----------
  if (offlineCoins >= 1){
    toast("Offline Coins", `+${fmt(offlineCoins)} (max 6h)`);
  }
  updateDerived();
  buildShop();
  requestAnimationFrame(loop);

})();
</script>
</body>
</html>
